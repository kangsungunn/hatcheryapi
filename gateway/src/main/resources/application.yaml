spring:
  web:
    cors:
      allowed-origins:
        - https://www.hatchery.kr
        - https://www-hatchery-kr.vercel.app
        - http://localhost:3000
      allowed-methods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
      allowed-headers: "*"
      allow-credentials: true
      max-age: 3600
  application:
    name: kroaddy-api
  server:
    port: 8080
  cloud:
    config:
      enabled: false

  # 데이터베이스 설정 (Neon PostgreSQL)
  # 주의: SPRING_DATASOURCE_URL에 이미 파라미터가 있으면 &currentSchema=public 추가 필요
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/kroaddy}
    username: ${SPRING_DATASOURCE_USERNAME:postgres}
    password: ${SPRING_DATASOURCE_PASSWORD:postgres}
    driver-class-name: ${SPRING_DATASOURCE_DRIVER_CLASS_NAME:org.postgresql.Driver}
    hikari:
      maximum-pool-size: ${SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE:10}
      minimum-idle: ${SPRING_DATASOURCE_HIKARI_MINIMUM_IDLE:5}
      connection-timeout: ${SPRING_DATASOURCE_HIKARI_CONNECTION_TIMEOUT:30000}
      # 연결 시마다 public 스키마를 사용하도록 설정
      connection-init-sql: "SET search_path TO public"

  # JPA 설정
  jpa:
    hibernate:
      ddl-auto: ${SPRING_JPA_HIBERNATE_DDL_AUTO:none}
    show-sql: ${SPRING_JPA_SHOW_SQL:false}
    properties:
      hibernate:
        format_sql: true
        default_schema: public  # 기본 스키마 명시
        # Entity의 @Table(schema = "public")을 존중하도록 설정
        use_sql_comments: true
        # 스키마를 명시적으로 사용
        globally_quoted_identifiers: false

  # Redis 설정 (Upstash 지원)
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: ${REDIS_TIMEOUT:2000}
      lettuce:
        pool:
          max-active: ${REDIS_POOL_MAX_ACTIVE:8}
          max-idle: ${REDIS_POOL_MAX_IDLE:8}
          min-idle: ${REDIS_POOL_MIN_IDLE:0}
        shutdown-timeout: ${REDIS_SHUTDOWN_TIMEOUT:100}

# Gateway는 Eureka 사용하지 않음
eureka:
  client:
    enabled: false

# JWT 설정
jwt:
  secret: ${JWT_SECRET:default-secret-key-change-in-production-min-32-characters}
  expiration: ${JWT_EXPIRATION:86400000} # 기본 24시간 (밀리초)
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000} # 기본 7일 (밀리초)

# OAuth 설정
kakao:
  rest-api-key: ${KAKAO_REST_API_KEY:}
  redirect-uri: ${KAKAO_REDIRECT_URI:http://localhost:8080/api/auth/kakao/callback}
  client-secret: ${KAKAO_CLIENT_SECRET:}

naver:
  client-id: ${NAVER_CLIENT_ID:}
  client-secret: ${NAVER_CLIENT_SECRET:}
  redirect-uri: ${NAVER_REDIRECT_URI:http://localhost:8080/api/auth/naver/callback}

google:
  client-id: ${GOOGLE_CLIENT_ID:}
  client-secret: ${GOOGLE_CLIENT_SECRET:}
  redirect-uri: ${GOOGLE_REDIRECT_URI:http://localhost:8080/api/auth/google/callback}

# 프론트엔드 설정
frontend:
  login-callback-url: ${FRONT_LOGIN_CALLBACK_URL:http://localhost:3000}
  login-success-path: ${FRONT_LOGIN_SUCCESS_PATH:/}

# 쿠키 설정
cookie:
  secure: ${COOKIE_SECURE:true} # 개발: false, 프로덕션: true (HTTPS 필수)
  same-site: ${COOKIE_SAME_SITE:None} # Lax, Strict, None (크로스 도메인: None)

# Swagger / Springdoc 설정
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /docs
    enabled: true
    try-it-out-enabled: true
    operations-sorter: method
    tags-sorter: alpha

  # 로깅 설정
  logging:
    level:
      root: ${LOG_LEVEL:INFO}
      com.kroaddy: ${LOG_LEVEL:DEBUG}
      org.springframework.web: ${LOG_LEVEL:INFO}
      org.hibernate: ${LOG_LEVEL:INFO}
      org.hibernate.SQL: ${LOG_LEVEL:DEBUG}
      org.hibernate.type.descriptor.sql.BasicBinder: ${LOG_LEVEL:TRACE}
      com.zaxxer.hikari: ${LOG_LEVEL:DEBUG}

# 배포 정보 설정 (GitHub Actions에서 주입)
app:
  build:
    time: ${BUILD_TIME:Unknown}
    version: ${BUILD_VERSION:dev}
  git:
    commit: ${GIT_COMMIT:Unknown}
    branch: ${GIT_BRANCH:main}
